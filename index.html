<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Tracker</title>
<style>
  /* Existing CSS styles */

  /* Additional styles for the delete button */
  #delete-button {
    background-color: red;
    color: white;
    margin-top: 10px;
    width: 100%;
  }

  /* Styles for the sort dropdown */
  .dropdown {
    float: left;
    overflow: hidden;
  }
  .dropdown .dropbtn {
    background-color: #333;
    color: white;
    padding: 14px 16px;
    border: none;
    cursor: pointer;
  }
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    z-index: 1;
  }
  .dropdown-content button {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    background: none;
    border: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
  }
  .dropdown-content button:hover {
    background-color: #ddd;
  }
  .dropdown:hover .dropdown-content {
    display: block;
  }
</style>
</head>
<body>

<div class="menu-bar">
  <button id="add-button">Add</button>
  <!-- Sort Button -->
  <div class="dropdown">
    <button class="dropbtn">Sort</button>
    <div class="dropdown-content" id="sort-options">
      <button data-field="name">By Name</button>
      <button data-field="engineer">By Engineer</button>
      <button data-field="date">By Date Updated</button>
      <button data-field="step">By Step</button>
      <button data-field="origin">By Origin</button>
    </div>
  </div>
</div>

<div id="product-container"></div>

<!-- Modal for adding/editing product info -->
<div id="product-modal" class="modal">
  <div class="modal-content">
    <h2 id="modal-title">Add Product</h2>
    <label>Product Name:
      <input type="text" id="product-name">
    </label>
    <label>Responsible Engineer:
      <input type="text" id="responsible-engineer">
    </label>
    <label>Date Updated:
      <input type="date" id="date-updated">
    </label>
    <!-- Fields for step and origin (not displayed on the square) -->
    <label>Step:
      <input type="text" id="step">
    </label>
    <label>Origin:
      <input type="text" id="origin">
    </label>
    <button id="save-button">Save</button>
    <button id="cancel-button">Cancel</button>
    <!-- Delete Button -->
    <button id="delete-button">Delete</button>
  </div>
</div>

<script>
    let products = [];
  
    // Load products from localStorage
    if (localStorage.getItem('products')) {
      products = JSON.parse(localStorage.getItem('products'));
    }
    
    // Variable to keep track of the current sort field
    let sortField = '';
    
    // Function to save products to localStorage
    function saveProducts() {
      localStorage.setItem('products', JSON.stringify(products));
    }
    
    // Function to render products
    function renderProducts() {
      const container = document.getElementById('product-container');
      container.innerHTML = ''; // Clear existing content
    
      // Sort products if sortField is set
      let sortedProducts = [...products];
      if (sortField) {
        sortedProducts.sort((a, b) => {
          let fieldA = a[sortField] ? a[sortField].toLowerCase() : '';
          let fieldB = b[sortField] ? b[sortField].toLowerCase() : '';
          if (fieldA < fieldB) return -1;
          if (fieldA > fieldB) return 1;
          return 0;
        });
      }
    
      sortedProducts.forEach((product, index) => {
        const square = document.createElement('div');
        square.className = 'product-square';
        square.dataset.index = index;
    
        // Display product name, responsible engineer, and date updated
        const name = document.createElement('div');
        name.textContent = `Name: ${product.name}`;
        square.appendChild(name);
    
        const engineer = document.createElement('div');
        engineer.textContent = `Engineer: ${product.engineer}`;
        square.appendChild(engineer);
    
        const date = document.createElement('div');
        date.textContent = `Updated: ${product.date}`;
        square.appendChild(date);
    
        // Info icon
        const infoIcon = document.createElement('div');
        infoIcon.className = 'info-icon';
        infoIcon.textContent = 'i';
        square.appendChild(infoIcon);
    
        // Click handler for info icon
        infoIcon.addEventListener('click', (e) => {
          e.stopPropagation(); // Prevent triggering square click
          alert(`More Info:\nStep: ${product.step}\nOrigin: ${product.origin}`);
        });
    
        // Click handler for square to edit
        square.addEventListener('click', () => {
          openModal('Edit Product', product, index);
        });
    
        container.appendChild(square);
      });
    }
    
    // Function to open the modal
    function openModal(title, product = {}, index) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('product-name').value = product.name || '';
      document.getElementById('responsible-engineer').value = product.engineer || '';
      document.getElementById('date-updated').value = product.date || '';
      document.getElementById('step').value = product.step || '';
      document.getElementById('origin').value = product.origin || '';
    
      // Store index in save button's dataset
      const saveButton = document.getElementById('save-button');
      saveButton.dataset.index = index !== undefined ? index : '';
    
      // Show or hide the delete button based on whether we're editing or adding
      const deleteButton = document.getElementById('delete-button');
      if (index !== undefined) {
        deleteButton.style.display = 'block';
        deleteButton.dataset.index = index;
      } else {
        deleteButton.style.display = 'none';
        deleteButton.dataset.index = '';
      }
    
      document.getElementById('product-modal').style.display = 'block';
    }
    
    // Close modal
    document.getElementById('cancel-button').addEventListener('click', () => {
      document.getElementById('product-modal').style.display = 'none';
    });
    
    // Save product
    document.getElementById('save-button').addEventListener('click', () => {
      const name = document.getElementById('product-name').value;
      const engineer = document.getElementById('responsible-engineer').value;
      const date = document.getElementById('date-updated').value;
      const step = document.getElementById('step').value;
      const origin = document.getElementById('origin').value;
    
      const product = { name, engineer, date, step, origin };
    
      const index = document.getElementById('save-button').dataset.index;
    
      if (index !== '') {
        // Edit existing product
        products[index] = product;
      } else {
        // Add new product
        products.push(product);
      }
    
      saveProducts();
      renderProducts();
      document.getElementById('product-modal').style.display = 'none';
    });
    
    // Delete product
    document.getElementById('delete-button').addEventListener('click', () => {
      const index = document.getElementById('delete-button').dataset.index;
      if (index !== '') {
        products.splice(index, 1);
        saveProducts();
        renderProducts();
        document.getElementById('product-modal').style.display = 'none';
      }
    });
    
    // Add button
    document.getElementById('add-button').addEventListener('click', () => {
      openModal('Add Product');
    });
    
    // Sort options
    const sortOptions = document.getElementById('sort-options');
    sortOptions.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        sortField = e.target.dataset.field;
        renderProducts();
      }
    });
    
    // Initial render
    renderProducts();

</script>

</body>
</html>
